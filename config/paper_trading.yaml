# Paper Trading Configuration - Vertical Spread Strategy
# Optimized for LOW tier ($5,000 starting capital)
# VALIDATED: +367% returns, 92.6% win rate (Feb-Nov 2024 backtest with QQQ)

app:
  name: "Alpaca Options Bot - Paper Trading"
  log_level: "INFO"
  timezone: "America/New_York"
  data_dir: "./data"

# Alpaca API Configuration - Paper Trading
alpaca:
  paper: true  # PAPER TRADING MODE
  data_feed: "iex"
  base_url: null

# Trading Configuration - VALIDATED SETTINGS
trading:
  enabled: true
  max_positions: 10
  max_concurrent_positions: 3  # Proven optimal in backtest (94 trades)
  max_order_value: 5000
  max_trading_capital: 5000  # $5k paper trading capital
  trading_hours_only: true
  order_timeout_seconds: 30
  default_order_type: "limit"
  limit_price_buffer: 0.02
  min_buying_power_reserve: 0.20  # 20% cash reserve (backtested)

# Risk Management - VALIDATED SETTINGS (Backtest: -1.82% max drawdown)
risk:
  max_portfolio_delta: 100  # Increased for 3 concurrent positions
  max_portfolio_gamma: 20
  max_portfolio_vega: 200
  min_portfolio_theta: -100

  max_drawdown_percent: 20  # Backtest showed 1.82%, using 20% safety margin
  daily_loss_limit: 500  # $500 daily loss limit

  max_single_position_percent: 25  # Proven optimal in backtest
  max_contracts_per_trade: 2  # Allow up to 2 contracts per trade

  min_days_to_expiry: 7
  max_days_to_expiry: 60
  min_open_interest: 100
  max_bid_ask_spread_percent: 5

# Strategy Configuration - Only Vertical Spread enabled
strategies:
  wheel:
    enabled: false
    allocation: 0.0

  iron_condor:
    enabled: false
    allocation: 0.0

  # Vertical Spread Strategy - PRIMARY STRATEGY
  # Optimized based on research: 20 delta, 30-45 DTE, profit/stop management
  vertical_spread:
    enabled: true
    allocation: 0.3
    capital_requirements:
      min_capital: 2000
      recommended_capital: 5000
      max_allocation_percent: 30
    config:
      underlyings:
        - "QQQ"  # Only QQQ for paper trading
      spread_width: 5
      delta_target: 0.20  # 20 delta = ~80% probability OTM
      min_credit: 30
      min_dte: 30  # Enter with 30+ DTE
      max_dte: 45
      close_dte: 21  # Close at 21 DTE to avoid gamma risk
      min_iv_rank: 30  # Only sell when IV is elevated
      max_spread_percent: 5.0
      min_open_interest: 100
      prefer_credit: true
      # RSI thresholds - widened for more opportunities
      rsi_oversold: 45
      rsi_overbought: 55
      # Profit/Loss management
      profit_target_pct: 0.50  # Close at 50% of max profit
      stop_loss_multiplier: 2.0  # Close at 2x credit received (loss)
      min_return_on_risk: 0.25  # Credit should be 1/4 of spread width

  cash_secured_put:
    enabled: false
    allocation: 0.0

  covered_call:
    enabled: false
    allocation: 0.0

# Backtesting Configuration (for reference)
backtesting:
  default_start_date: "2024-01-01"
  default_end_date: "2024-11-15"
  initial_capital: 5000

  execution:
    slippage_model: "percentage"
    slippage_value: 0.02
    commission_per_contract: 0.65

  data:
    underlying_timeframe: "1h"
    options_snapshot_interval: "15min"
    use_adjusted_prices: true
    cache_enabled: true
    cache_dir: "./data/historical"

# Terminal UI Configuration
ui:
  refresh_rate: 1.0
  show_greeks: true
  show_performance: true
  log_lines: 15
  theme: "default"

  panels:
    positions: true
    orders: true
    strategies: true
    greeks: true
    performance: true
    logs: true

# Logging Configuration
logging:
  console_level: "INFO"
  file_level: "DEBUG"
  log_file: "./data/logs/paper_trading.log"
  max_file_size_mb: 10
  backup_count: 5

# Screener Configuration - Dynamic Symbol Discovery
screener:
  enabled: true  # Enable screener for opportunity discovery

  # Scan mode: technical_only, options_only, or hybrid
  mode: "hybrid"  # Use both technical and options screening

  # Symbol universe selection
  universe: "options_friendly"  # Options-friendly stocks (QQQ, SPY, AAPL, etc.)
  custom_symbols:  # Additional symbols to monitor
    - "QQQ"  # Primary focus
    - "SPY"  # Backup option

  # Result limits
  max_results: 10  # Top 10 opportunities
  min_combined_score: 60.0  # Minimum score to qualify (0-100)

  # Scoring weights for hybrid mode
  technical_weight: 0.6  # 60% weight on technical analysis (RSI, MA, etc.)
  options_weight: 0.4  # 40% weight on options metrics (IV, liquidity)

  # Filtering requirements
  require_options: true  # Must have tradeable options
  require_signal: true  # Must have bullish/bearish signal (RSI-based)

  # Refresh settings
  auto_refresh_seconds: 300  # Scan every 5 minutes
  cache_ttl_seconds: 300  # Cache results for 5 minutes

  # Technical criteria (RSI-based signals)
  technical_criteria:
    rsi_oversold: 45  # RSI <= 45 = bullish signal
    rsi_overbought: 55  # RSI >= 55 = bearish signal
    min_volume: 1000000  # Minimum daily volume

  # Options criteria
  options_criteria:
    min_iv_rank: 30  # Minimum IV rank (matches vertical spread strategy)
    min_open_interest: 100  # Minimum OI for liquidity
    max_bid_ask_spread: 0.05  # Max 5% bid-ask spread
    min_dte: 30  # Minimum DTE available
    max_dte: 45  # Maximum DTE preferred

# Notifications
notifications:
  enabled: false
