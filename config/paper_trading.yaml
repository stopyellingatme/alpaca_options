# Paper Trading Configuration - Vertical Spread Strategy
# Optimized for LOW tier ($10,000 starting capital)
# VALIDATED: 6-year backtest (2019-2024) with AAPL, MSFT, NVDA, SPY
# DEPLOYMENT STATUS: Production-ready for paper trading (Validated Dec 2024)
# PERFORMANCE: +174.95% avg return, 75.3% win rate, 1.97 Sharpe ratio (6-year avg)

app:
  name: "Alpaca Options Bot - Paper Trading"
  log_level: "INFO"
  timezone: "America/New_York"
  data_dir: "./data"

# Alpaca API Configuration - Paper Trading
alpaca:
  paper: true  # PAPER TRADING MODE
  data_feed: "iex"
  base_url: null

# Trading Configuration - VALIDATED SETTINGS
trading:
  enabled: true
  max_positions: 10
  max_concurrent_positions: 3  # Proven optimal in backtest (93 trades over 6 years)
  max_order_value: 10000
  max_trading_capital: 10000  # $10k paper trading capital (matches backtest)
  trading_hours_only: true
  order_timeout_seconds: 30
  default_order_type: "limit"
  limit_price_buffer: 0.02
  min_buying_power_reserve: 0.20  # 20% cash reserve (backtested)

# Risk Management - VALIDATED SETTINGS (6-year backtest: -14.51% avg max drawdown)
risk:
  max_portfolio_delta: 100  # Increased for 3 concurrent positions
  max_portfolio_gamma: 20
  max_portfolio_vega: 200
  min_portfolio_theta: -100

  max_drawdown_percent: 20  # 6-year backtest showed -14.51% avg, using 20% safety margin
  daily_loss_limit: 500  # $500 daily loss limit

  max_single_position_percent: 25  # Proven optimal in backtest
  max_contracts_per_trade: 2  # Allow up to 2 contracts per trade

  min_days_to_expiry: 7
  max_days_to_expiry: 60
  min_open_interest: 100
  max_bid_ask_spread_percent: 5

# Strategy Configuration - Only Vertical Spread enabled
strategies:
  wheel:
    enabled: false
    allocation: 0.0

  iron_condor:
    enabled: false
    allocation: 0.0

  # Vertical Spread Strategy - PRIMARY STRATEGY
  # VALIDATED: 6-year backtest (2019-2024) - SPY: +118.88%, 78.6% win rate, 1.10 Sharpe
  # Based on DoltHub-optimized parameters from backtest_multi_symbol.py
  vertical_spread:
    enabled: true
    allocation: 0.3
    capital_requirements:
      min_capital: 2000
      recommended_capital: 10000  # Matches backtest initial capital
      max_allocation_percent: 30
    config:
      underlyings:
        - "SPY"  # VALIDATED: +118.88% over 6 years, 78.6% win rate, 28 trades
      spread_width: 5.0  # Matches backtest
      delta_target: 0.20  # 20 delta = ~80% probability OTM
      min_credit: 15.0  # BACKTEST VALUE: $15 minimum credit
      min_dte: 21  # BACKTEST VALUE: 21-45 DTE entry range
      max_dte: 45
      close_dte: 14  # CRITICAL FIX: Close at 14 DTE (was 21, backtest uses 14)
      min_iv_rank: 0  # BACKTEST VALUE: DoltHub has no IV rank (set to 0)
      max_spread_percent: 15.0  # BACKTEST VALUE: Allow up to 15% spreads
      min_open_interest: 0  # BACKTEST VALUE: DoltHub has OI=0, but use 50+ for live
      prefer_credit: true
      # RSI thresholds - VALIDATED in backtest
      rsi_oversold: 45.0  # BACKTEST VALUE: Triggers bullish (bull put spread)
      rsi_overbought: 55.0  # BACKTEST VALUE: Triggers bearish (bear call spread)
      # Profit/Loss management - VALIDATED in backtest
      profit_target_pct: 0.50  # Close at 50% of max profit
      stop_loss_multiplier: 2.0  # Close at 2x credit received (loss)
      min_return_on_risk: 0.08  # BACKTEST VALUE: 8% minimum ROR (credit/risk ratio)

  cash_secured_put:
    enabled: false
    allocation: 0.0

  covered_call:
    enabled: false
    allocation: 0.0

# Backtesting Configuration (for reference)
backtesting:
  default_start_date: "2019-02-09"  # Extended backtest start
  default_end_date: "2024-12-31"     # Extended backtest end
  initial_capital: 10000  # Matches 6-year backtest

  execution:
    # Phase 1: Adaptive Slippage (COMPLETE)
    slippage_model: "adaptive"  # Real market data-based slippage (Phase 1 improvement)
    # slippage_value: 0.02  # Not used by adaptive model (uses delta-based real spreads)
    commission_per_contract: 0.65

    # Phase 2A: Fill Probability Model (ENABLED FOR TESTING)
    enable_fill_probability: true  # Enable to model realistic order fill probability
    min_oi_threshold: 100  # Minimum OI to trade (reject below this)
    max_spread_threshold: 0.10  # Max 10% bid-ask spread (reject above this)
    illiquid_hour_multiplier: 0.85  # 15% penalty at market open/close
    high_vix_multiplier: 0.90  # 10% penalty when VIX > 30

    # Phase 2A: Gap Risk Model (ENABLED FOR TESTING)
    enable_gap_risk: true  # Enable to model overnight/weekend gap risk
    avg_overnight_gap: 0.005  # 0.5% average overnight gap (based on SPY/QQQ data)
    weekend_gap_multiplier: 1.6  # 60% larger gaps over weekends
    earnings_gap_multiplier: 3.0  # 3x gap on earnings (not yet implemented)
    gap_stop_loss_slippage: 0.02  # Extra 2% slippage when stop triggered during gap

  data:
    underlying_timeframe: "1h"
    options_snapshot_interval: "15min"
    use_adjusted_prices: true
    cache_enabled: true
    cache_dir: "./data/historical"

# Terminal UI Configuration
ui:
  refresh_rate: 1.0
  show_greeks: true
  show_performance: true
  log_lines: 15
  theme: "default"

  panels:
    positions: true
    orders: true
    strategies: true
    greeks: true
    performance: true
    logs: true

# Logging Configuration
logging:
  console_level: "INFO"
  file_level: "DEBUG"
  log_file: "./data/logs/paper_trading.log"
  max_file_size_mb: 10
  backup_count: 5

# Screener Configuration - Dynamic Symbol Discovery
# Enhanced with consensus signals: Requires 3+ of 5 indicators (RSI, MACD, Bollinger Bands, Stochastic, ROC) to agree
screener:
  enabled: true  # Enable screener for opportunity discovery

  # Scan mode: technical_only, options_only, or hybrid
  mode: "hybrid"  # Use both technical and options screening

  # Symbol universe selection
  universe: "options_friendly"  # Options-friendly stocks (QQQ, SPY, AAPL, etc.)
  custom_symbols:  # Additional symbols to monitor
    - "SPY"  # PRIMARY: Validated with +118.88% over 6 years, 78.6% win rate
    - "AAPL"  # OPTIONAL: Best performer +367.16%, 92.6% win rate (add after SPY success)

  # Result limits
  max_results: 10  # Top 10 opportunities
  min_combined_score: 60.0  # Minimum score to qualify (0-100)

  # Scoring weights for hybrid mode
  technical_weight: 0.6  # 60% weight on technical analysis (RSI, MA, etc.)
  options_weight: 0.4  # 40% weight on options metrics (IV, liquidity)

  # Filtering requirements
  require_options: true  # Must have tradeable options
  require_signal: true  # Must have bullish/bearish signal (RSI-based)

  # Refresh settings
  auto_refresh_seconds: 300  # Scan every 5 minutes
  cache_ttl_seconds: 300  # Cache results for 5 minutes

  # Technical criteria (RSI-based signals)
  technical_criteria:
    rsi_oversold: 45  # RSI <= 45 = bullish signal
    rsi_overbought: 55  # RSI >= 55 = bearish signal
    min_volume: 1000000  # Minimum daily volume

  # Options criteria
  options_criteria:
    min_iv_rank: 30  # Minimum IV rank (matches vertical spread strategy)
    min_open_interest: 100  # Minimum OI for liquidity
    max_bid_ask_spread: 0.05  # Max 5% bid-ask spread
    min_dte: 30  # Minimum DTE available
    max_dte: 45  # Maximum DTE preferred

# Notifications
notifications:
  enabled: false
